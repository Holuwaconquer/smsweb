<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Femzy</title>
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/chatbot.css" />
  </head>
  <body>
    <!-- Top Navigation -->
    <nav class="top-nav">
      <div class="nav-left">
        <div class="hamburger" id="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="logo">
          <div class="logo-icon">F</div>
          <span>Femzy</span>
        </div>
        <div class="nav-links">
          <a href="#" class="nav-link active">ğŸ  Dashboard</a>
          <a href="usa-numbers.html" class="nav-link">ğŸ“± USA Numbers</a>
          <a href="all-countries.html" class="nav-link">ğŸŒ All Countries</a>
          <a href="history.html" class="nav-link">ğŸ• History</a>
        </div>
      </div>
      <div class="nav-right">
        <div class="balance-badge" id="balanceDisplay">â‚¦0.00</div>
        <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
      </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Menu</div>
        <a href="#" class="sidebar-link active">
          <span class="sidebar-icon">ğŸ </span>
          <span>Dashboard</span>
        </a>
        <a href="usa-numbers.html" class="sidebar-link">
          <span class="sidebar-icon">ğŸ“±</span>
          <span>USA Numbers</span>
        </a>
        <a href="all-countries.html" class="sidebar-link">
          <span class="sidebar-icon">ğŸŒ</span>
          <span>All Countries</span>
        </a>
        <a href="history.html" class="sidebar-link">
          <span class="sidebar-icon">ğŸ•</span>
          <span>History</span>
        </a>
        <a href="wallet.html" class="sidebar-link">
          <span class="sidebar-icon">ğŸ’°</span>
          <span>Wallet</span>
        </a>
        <a href="profile.html" class="sidebar-link">
          <span class="sidebar-icon">ğŸ‘¤</span>
          <span>Profile</span>
        </a>
        <a href="#" class="sidebar-link" id="contactLink">
          <span class="sidebar-icon">ğŸ“</span>
          <span>Contact Us</span>
        </a>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Account</div>
        <a href="../admin/index.html" class="sidebar-link admin-link">
          <span class="sidebar-icon">âš™ï¸</span>
          <span>Admin Panel</span>
        </a>
        <a href="#" class="sidebar-link" id="logoutBtn">
          <span class="sidebar-icon">ğŸšª</span>
          <span>Log Out</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="page-header">
        <h1>Welcome back!</h1>
        <p>Here's what's happening with your account today</p>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-title">Balance</span>
            <div class="stat-icon" style="background: #e0f7f4; color: #00d4aa">
              ğŸ“
            </div>
          </div>
          <div class="stat-value" id="statsBalance">â‚¦0.00</div>
          <div class="stat-change positive">
            <span>â†—</span>
            <span>Ready to use</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-title">Messages Received</span>
            <div class="stat-icon" style="background: #e3f2fd; color: #2196f3">
              ğŸ’¬
            </div>
          </div>
          <div class="stat-value">0</div>
          <div class="stat-change">
            <span>â€”</span>
            <span>No messages yet</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-title">Total Spent</span>
            <div class="stat-icon" style="background: #fce4ec; color: #e91e63">
              ğŸ“Š
            </div>
          </div>
          <div class="stat-value">â‚¦0</div>
          <div class="stat-change">
            <span>â€”</span>
            <span>Start using services</span>
          </div>
        </div>
      </div>

      <!-- Quick Access -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">Quick Access</h2>
        </div>
        <div class="quick-access">
          <div
            class="access-card"
            onclick="window.location.href = 'usa-numbers.html'"
          >
            <div class="access-icon">ğŸ“±</div>
            <h3>USA Numbers</h3>
            <p>Get US phone numbers for verification</p>
          </div>

          <div
            class="access-card"
            onclick="window.location.href = 'all-countries.html'"
          >
            <div class="access-icon">ğŸŒ</div>
            <h3>All Countries</h3>
            <p>Browse numbers from 50+ countries</p>
          </div>

          <div
            class="access-card"
            onclick="window.location.href = 'history.html'"
          >
            <div class="access-icon">ğŸ•</div>
            <h3>History</h3>
            <p>View your usage history</p>
          </div>
        </div>
      </div>

      <!-- Features Info -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">Global Coverage</h2>
        </div>
        <div
          style="
            background: linear-gradient(135deg, #e0f7f4, #ccf3ed);
            padding: 30px;
            border-radius: 12px;
          "
        >
          <h3 style="margin-bottom: 15px">
            ğŸ“ Numbers from 50+ countries available
          </h3>
          <p style="margin-bottom: 10px; color: #666">
            â€¢ Pricing varies by country and service
          </p>
          <p style="margin-bottom: 10px; color: #666">
            â€¢ Both VoIP and Non-VoIP options
          </p>
          <p style="margin-bottom: 10px; color: #666">
            â€¢ Real-time SMS delivery
          </p>
          <p style="color: #666">â€¢ Multiple services supported per number</p>
        </div>
      </div>
    </main>

    <!-- Chat Button -->
    <div class="chat-button">
      <svg viewBox="0 0 24 24">
        <path
          fill="white"
          d="M12 2C6.48 2 2 6.48 2 12c0 1.54.36 3 .97 4.29L2 22l5.71-.97C9 21.64 10.46 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.42 0-2.76-.3-3.97-.85l-.28-.14-2.9.49.49-2.9-.14-.28C4.3 14.76 4 13.42 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z"
        />
      </svg>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Paystack Inline JS -->
    <script src="https://js.paystack.co/v1/inline.js"></script>

    <!-- Configuration and Scripts -->
    <script src="../js/supabase-config.js"></script>
    <script src="../js/dashboard.js"></script>
    <script src="../js/chatbot.js"></script>
    <script>
      // Auth check on page load
      document.addEventListener("DOMContentLoaded", async () => {
        // 1. Maintenance Check (First thing!)
        await checkMaintenanceMode();

        // 2. Auth Check
        const {
          data: { user },
        } = await supabase.auth.getUser();
        if (!user) {
          window.location.href = "../auth.html";
          return;
        }

        // 3. Load User Data
        const profile = await getProfile(user.id);
        if (profile) {
          document.querySelector(".page-header h1").textContent =
            `Welcome back, ${profile.full_name || profile.username || "User"}!`;

          // Show admin link if admin
          if (profile.is_admin) {
            document
              .querySelectorAll(".admin-link")
              .forEach((el) => (el.style.display = "flex"));
          } else {
            document
              .querySelectorAll(".admin-link")
              .forEach((el) => (el.style.display = "none"));
          }
        }

        // 4. Load Wallet Data
        const wallet = await getWallet(user.id);
        const balanceFormatted = `â‚¦${parseFloat(wallet.balance || 0).toFixed(2)}`;
        document.getElementById("balanceDisplay").textContent =
          balanceFormatted;
        document.getElementById("statsBalance").textContent = balanceFormatted;

        const spentVal = document.querySelector(
          ".stat-card:nth-child(3) .stat-value",
        );
        if (spentVal)
          spentVal.textContent = `â‚¦${parseFloat(wallet.total_spent || 0).toFixed(0)}`;

        // 5. Hamburger menu toggle
        const hamburger = document.getElementById("hamburger");
        const sidebar = document.getElementById("sidebar");

        if (hamburger && sidebar) {
          // Toggle sidebar on hamburger click
          function toggleSidebar(e) {
            if (e) {
              e.stopPropagation();
              e.preventDefault();
            }
            hamburger.classList.toggle("active");
            sidebar.classList.toggle("active");
          }

          hamburger.addEventListener("click", toggleSidebar);
          hamburger.addEventListener("touchstart", toggleSidebar);

          // Close sidebar when clicking outside
          document.addEventListener(
            "click",
            (e) => {
              const isClickOnHamburger = hamburger.contains(e.target);
              const isClickOnSidebar = sidebar.contains(e.target);

              if (
                !isClickOnHamburger &&
                !isClickOnSidebar &&
                sidebar.classList.contains("active")
              ) {
                hamburger.classList.remove("active");
                sidebar.classList.remove("active");
              }
            },
            true,
          );

          // Close sidebar when clicking a link on mobile
          document.querySelectorAll(".sidebar-link").forEach((link) => {
            link.addEventListener("click", () => {
              if (window.innerWidth <= 768) {
                hamburger.classList.remove("active");
                sidebar.classList.remove("active");
              }
            });
          });
        }

        // Logout button handler
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", async (e) => {
            e.preventDefault();
            if (confirm("Are you sure you want to log out?")) {
              await supabase.auth.signOut();
              window.location.href = "../auth.html";
            }
          });
        }
      });
    </script>
  </body>
</html>
